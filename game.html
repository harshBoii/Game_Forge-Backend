<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Camping Adventure - Phaser Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body { margin:0; padding:0; background:#021; height:100%; }
    .hint { position:absolute; right:12px; top:12px; color:#ddd; font-family:monospace; font-size:13px; background:rgba(0,0,0,0.25); padding:8px; border-radius:6px; z-index: 1000;}
  </style>
</head>
<body>
  <div class="hint">WASD to move â€¢ Collect stones (4) & wood (3) â€¢ Build fire pit & pitch tent</div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>

  <script>
  class CampingScene extends Phaser.Scene {
    constructor() { super('CampingScene'); }
    
    preload() {
      this.generatePixelArtTextures();
    }
    
    generatePixelArtTextures() {
        const createTexture = (name, width, height, drawCallback) => {
            if (this.textures.exists(name)) return;
            const g = this.add.graphics();
            drawCallback(g);
            g.generateTexture(name, width, height);
            g.destroy();
        };

        // Player
        createTexture('player', 16, 24, g => {
            g.fillStyle(0x4a4a4a);
            g.fillRect(0, 0, 16, 18);
            g.fillStyle(0x1e50a0);
            g.fillRect(0, 18, 16, 6);
            g.fillStyle(0xffcc99);
            g.fillRect(4, 2, 8, 8);
        });

        // Wood
        createTexture('wood', 20, 8, g => {
            g.fillStyle(0x8b4513);
            g.fillRect(0, 0, 20, 8);
            g.fillStyle(0x654321);
            g.fillRect(0, 0, 20, 2);
        });

        // Stone
        createTexture('stone', 12, 12, g => {
            g.fillStyle(0x808080);
            g.fillRect(0, 0, 12, 12);
            g.fillStyle(0x696969);
            g.fillRect(2, 2, 8, 8);
        });
        
        // Campfire States
        createTexture('campfire_empty', 48, 48, g => {
            const stones = [[16, 4], [32, 10], [36, 24], [24, 36], [10, 32], [4, 16]];
            g.fillStyle(0x808080);
            stones.forEach(s => g.fillRect(s[0], s[1], 12, 12));
        });

        createTexture('campfire_pit', 48, 48, g => {
            const stones = [[16, 4], [32, 10], [36, 24], [24, 36], [10, 32], [4, 16]];
            g.fillStyle(0x808080);
            stones.forEach(s => g.fillRect(s[0], s[1], 12, 12));
        });

        createTexture('campfire_wood', 48, 48, g => {
            const stones = [[16, 4], [32, 10], [36, 24], [24, 36], [10, 32], [4, 16]];
            g.fillStyle(0x808080);
            stones.forEach(s => g.fillRect(s[0], s[1], 12, 12));
            g.fillStyle(0x8b4513);
            g.fillRect(18, 18, 18, 6);
            g.fillRect(20, 24, 6, 10);
        });

        createTexture('campfire_lit', 48, 48, g => {
            const stones = [[16, 4], [32, 10], [36, 24], [24, 36], [10, 32], [4, 16]];
            g.fillStyle(0x808080);
            stones.forEach(s => g.fillRect(s[0], s[1], 12, 12));
            g.fillStyle(0xff6600);
            g.fillRect(18, 16, 12, 12);
            g.fillStyle(0xffaa00);
            g.fillRect(20, 12, 8, 8);
            g.fillStyle(0xffff00);
            g.fillRect(22, 10, 4, 4);
        });

        // Tent States
        createTexture('tent_materials', 64, 32, g => {
            g.fillStyle(0x8b4513);
            g.fillRect(0, 24, 64, 8);
            g.fillStyle(0x006400);
            g.fillRect(10, 0, 20, 24);
        });

        createTexture('tent_pitched', 64, 48, g => {
            g.fillStyle(0x008000);
            g.fillTriangle(0, 48, 32, 0, 64, 48);
            g.fillStyle(0x006400);
            g.fillTriangle(24, 48, 32, 16, 40, 48);
        });
    }
    
    // Create simple procedural sounds
    createSimpleAudio() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        
        // Water ambient sound (low-pass filtered noise)
        const waterBuffer = ctx.createBuffer(1, ctx.sampleRate * 3, ctx.sampleRate);
        const waterData = waterBuffer.getChannelData(0);
        for (let i = 0; i < waterData.length; i++) {
            waterData[i] = (Math.random() * 2 - 1) * 0.1;
        }
        
        // Cricket sound (modulated sine)
        const cricketBuffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
        const cricketData = cricketBuffer.getChannelData(0);
        for (let i = 0; i < cricketData.length; i++) {
            const t = i / ctx.sampleRate;
            cricketData[i] = Math.sin(t * 2 * Math.PI * 1500) * 
                             (Math.sin(t * 2 * Math.PI * 5) * 0.5 + 0.5) * 0.05;
        }
        
        // Fire crackle (short noise bursts)
        const fireBuffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
        const fireData = fireBuffer.getChannelData(0);
        for (let i = 0; i < fireData.length; i++) {
            fireData[i] = Math.random() < 0.01 ? (Math.random() * 2 - 1) * 0.5 : 0;
        }
        
        return { water: waterBuffer, cricket: cricketBuffer, fire: fireBuffer };
    }
    
    create() {
      this.gameState = 'PLAYING';
      this.inventory = { wood: 0, stone: 0 };
      this.required = { wood: 3, stone: 4 };

      this.goals = {
          campfire: 'NEEDS_PIT',
          tent: 'NOT_PITCHED'
      };

      this.interacting = false;

      this.createLandscape();
      this.initLightingAndCycle();
      this.initSounds();

      this.createPlayer();
      this.createCollectibles();
      this.createCampfire();
      this.createTent();
      this.createUI();

      this.keys = this.input.keyboard.addKeys('W,A,S,D');

      this.physics.add.overlap(this.player, this.collectibles, this.collectItem, null, this);
      this.physics.add.overlap(this.player, this.campfire, this.interactWithCampfire, null, this);
      this.physics.add.overlap(this.player, this.tent, this.interactWithTent, null, this);
    }

    update() {
      if (this.gameState === 'PLAYING') {
        this.updatePlayer();
      }
    }

    createLandscape() {
      this.add.rectangle(450, 380, 900, 440, 0x1a4d1a).setDepth(-1);
      this.add.rectangle(450, 80, 900, 160, 0x0055aa).setDepth(-1);
    }

    initLightingAndCycle() {
        this.lights.enable();
        this.lights.setAmbientColor(0xdddddd);

        const dayColor = new Phaser.Display.Color(221, 221, 221);
        const nightColor = new Phaser.Display.Color(20, 20, 50);

        this.tweens.add({
            targets: { value: 0 },
            value: 1,
            duration: 180000,
            ease: 'Sine.easeInOut',
            onUpdate: (tween) => {
                const colorObject = Phaser.Display.Color.Interpolate.ColorWithColor(
                    dayColor, nightColor, 100, tween.getValue() * 100
                );
                const color = Phaser.Display.Color.GetColor(colorObject.r, colorObject.g, colorObject.b);
                this.lights.setAmbientColor(color);
            }
        });
    }

    initSounds() {
        // Play simple ambient sounds using Web Audio API
        try {
            const audioBuffers = this.createSimpleAudio();
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            
            // Water sound
            const waterSource = ctx.createBufferSource();
            waterSource.buffer = audioBuffers.water;
            waterSource.loop = true;
            const waterGain = ctx.createGain();
            waterGain.gain.value = 0.2;
            waterSource.connect(waterGain);
            waterGain.connect(ctx.destination);
            waterSource.start(0);
            
            // Cricket sound
            const cricketSource = ctx.createBufferSource();
            cricketSource.buffer = audioBuffers.cricket;
            cricketSource.loop = true;
            const cricketGain = ctx.createGain();
            cricketGain.gain.value = 0.1;
            cricketSource.connect(cricketGain);
            cricketGain.connect(ctx.destination);
            cricketSource.start(0);
            
            // Fire sound (stored for later volume control)
            this.fireSource = ctx.createBufferSource();
            this.fireSource.buffer = audioBuffers.fire;
            this.fireSource.loop = true;
            this.fireGain = ctx.createGain();
            this.fireGain.gain.value = 0;
            this.fireSource.connect(this.fireGain);
            this.fireGain.connect(ctx.destination);
            this.fireSource.start(0);
        } catch (e) {
            console.log('Audio context not available');
        }
    }

    createPlayer() {
      this.player = this.physics.add.sprite(100, 300, 'player');
      this.player.setCollideWorldBounds(true);
      this.player.setDepth(5);
      this.player.speed = 200;
    }

    createCollectibles() {
      this.collectibles = this.physics.add.group();
      const spawnArea = new Phaser.Geom.Rectangle(50, 200, 800, 350);

      const spawnItems = (key, type, count) => {
        for (let i = 0; i < count; i++) {
            let pos = Phaser.Geom.Rectangle.Random(spawnArea);
            const item = this.collectibles.create(pos.x, pos.y, key);
            item.itemType = type;
            item.setDepth(1);
        }
      };

      spawnItems('wood', 'wood', 8);
      spawnItems('stone', 'stone', 10);
    }
    
    createCampfire() {
      this.campfire = this.physics.add.sprite(450, 300, 'campfire_empty');
      this.campfire.setImmovable(true);
      this.campfire.setDepth(1);
      this.campfireLight = null;
    }

    createTent() {
      this.tent = this.physics.add.sprite(750, 450, 'tent_materials');
      this.tent.setImmovable(true);
      this.tent.setDepth(1);
    }

    updatePlayer() {
      this.player.setVelocity(0);
      if (this.keys.W.isDown) this.player.setVelocityY(-this.player.speed);
      if (this.keys.S.isDown) this.player.setVelocityY(this.player.speed);
      if (this.keys.A.isDown) this.player.setVelocityX(-this.player.speed);
      if (this.keys.D.isDown) this.player.setVelocityX(this.player.speed);
    }

    collectItem(player, item) {
      this.inventory[item.itemType]++;
      item.destroy();
      this.updateUI();
    }

    interactWithCampfire() {
        if (this.interacting) return;
        
        if (this.goals.campfire === 'NEEDS_PIT' && this.inventory.stone >= this.required.stone) {
            this.interacting = true;
            this.inventory.stone -= this.required.stone;
            this.goals.campfire = 'NEEDS_WOOD';
            this.campfire.setTexture('campfire_pit');
            this.updateUI();
            this.time.delayedCall(500, () => { this.interacting = false; });
        } else if (this.goals.campfire === 'NEEDS_WOOD' && this.inventory.wood >= this.required.wood) {
            this.interacting = true;
            this.inventory.wood -= this.required.wood;
            this.goals.campfire = 'LIT';
            this.campfire.setTexture('campfire_lit');
            this.lightTheFire();
            this.updateUI();
            this.checkWinCondition();
            this.time.delayedCall(500, () => { this.interacting = false; });
        }
    }

    interactWithTent() {
        if (this.interacting) return;
        
        if (this.goals.tent === 'NOT_PITCHED') {
            this.interacting = true;
            this.goals.tent = 'PITCHED';
            this.tent.setTexture('tent_pitched');
            this.updateUI();
            this.checkWinCondition();
            this.time.delayedCall(500, () => { this.interacting = false; });
        }
    }

    lightTheFire() {
        if (this.fireGain) {
            this.tweens.add({
                targets: this.fireGain.gain,
                value: 0.6,
                duration: 1000
            });
        }
        
        if (this.campfireLight) {
            this.campfireLight.destroy();
        }
        
        this.campfireLight = this.lights.addLight(this.campfire.x, this.campfire.y, 250, 0xffa500, 1.5);

        this.time.addEvent({
            delay: 100,
            loop: true,
            callback: () => {
                if (this.campfireLight) {
                    this.campfireLight.intensity = 1.5 + Math.random() * 0.5;
                    this.campfireLight.radius = 250 + Math.random() * 30;
                }
            }
        });
    }

    checkWinCondition() {
        if (this.goals.campfire === 'LIT' && this.goals.tent === 'PITCHED') {
            this.gameState = 'WON';
            this.time.delayedCall(1000, this.showVictory, [], this);
        }
    }

    showVictory() {
      this.add.rectangle(450, 300, 900, 600, 0x000000, 0.8).setDepth(100);
      this.add.text(450, 250, 'Camp is Set!', {
        fontFamily: 'monospace', fontSize: 48, color: '#ffff00', fontStyle: 'bold', align: 'center'
      }).setOrigin(0.5).setDepth(101);
      this.add.text(450, 320, 'You survived the night!', {
        fontFamily: 'monospace', fontSize: 24, color: '#cccccc', align: 'center'
      }).setOrigin(0.5).setDepth(101);
      this.add.text(450, 450, 'Click to Play Again', {
        fontFamily: 'monospace', fontSize: 18, color: '#888888', align: 'center'
      }).setOrigin(0.5).setDepth(101).setInteractive();
      this.input.once('pointerdown', () => this.scene.restart());
    }

    createUI() {
      const style = { fontFamily: 'monospace', fontSize: 16, color: '#ffffff', backgroundColor: 'rgba(0,0,0,0.5)', padding: { x: 8, y: 4 }};
      this.stoneText = this.add.text(16, 16, '', style).setDepth(50);
      this.woodText = this.add.text(16, 46, '', style).setDepth(50);
      this.fireText = this.add.text(16, 76, '', style).setDepth(50);
      this.tentText = this.add.text(16, 106, '', style).setDepth(50);
      this.updateUI();
    }

    updateUI() {
        this.stoneText.setText(`Stones: ${this.inventory.stone} / ${this.required.stone}`);
        this.woodText.setText(`Wood:   ${this.inventory.wood} / ${this.required.wood}`);

        let fireStatus = '';
        switch(this.goals.campfire) {
            case 'NEEDS_PIT': fireStatus = `ðŸ”¥ Bring ${this.required.stone} stones to fire pit`; break;
            case 'NEEDS_WOOD': fireStatus = `ðŸ”¥ Bring ${this.required.wood} wood to fire pit`; break;
            case 'LIT': fireStatus = 'âœ… Fire is lit!'; break;
        }
        this.fireText.setText(fireStatus);
        
        let tentStatus = this.goals.tent === 'PITCHED' ? 'âœ… Tent is pitched!' : 'â›º Go to tent materials to build';
        this.tentText.setText(tentStatus);
    }
  }
  </script>

  <script>
  const config = {
    type: Phaser.AUTO,
    width: 900,
    height: 600,
    backgroundColor: 0x001a33,
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 0 },
        debug: false
      }
    },
    scene: [CampingScene]
  };
  </script>

  <script>
  window.onload = () => {
    const game = new Phaser.Game(config);
  };
  </script>

</body>
</html>
