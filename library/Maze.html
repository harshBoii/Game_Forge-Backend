<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pac-Man Maze - Vanilla Canvas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: monospace;
        }
        
        #gameContainer {
            position: relative;
            background: #000;
            border: 2px solid #222;
        }
        
        canvas {
            display: block;
            background: #000;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .hint {
            position: absolute;
            right: 12px;
            top: 12px;
            color: #ddd;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px;
            border-radius: 6px;
            max-width: 200px;
            text-align: center;
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: #ffff00;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #ffff00;
        }
        
        #gameOver div {
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="768" height="288"></canvas>
        <div id="ui">Score: <span id="score">0</span></div>
        <div class="hint">Arrow keys to move â€¢ Collect dots â€¢ Avoid ghosts â€¢ Power pellets = eat ghosts!</div>
        <div id="gameOver"></div>
    </div>

    <script>
        // =====================================================
        // CANVAS SETUP
        // =====================================================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        console.log('âœ… Pac-Man Game Canvas initialized');

        // =====================================================
        // GAME STATE (âœ… MODIFY THESE VALUES)
        // =====================================================
        const game = {
            cellSize: 32,
            moveSpeed: 2,
            score: 0,
            gameRunning: true,
            powerMode: false,
            powerEndTime: 0,
            
            maze: [
                '########################',
                '#..........##..........#',
                '#.####.###.##.###.####.#',
                '#P.....................P#',
                '#.####.#.######.#.####.#',
                '#......#....##....#....#',
                '######.#### ## ####.####',
                '#......................#',
                '########################'
            ],
            
            colors: {
                wall: '#2233aa',
                player: '#ffcc00',
                dot: '#ffdd44',
                pellet: '#ff00ff',
                ghost: ['#ff5555', '#55ffff', '#ff55ff', '#ffaa55']
            }
        };

        // =====================================================
        // ENTITY CLASSES
        // =====================================================
        class Entity {
            constructor(gridX, gridY) {
                this.gridX = gridX;
                this.gridY = gridY;
                this.x = gridX * game.cellSize + game.cellSize / 2;
                this.y = gridY * game.cellSize + game.cellSize / 2;
                this.direction = null;
                this.nextDirection = null;
            }
            
            canMove(dir) {
                let checkX = this.gridX;
                let checkY = this.gridY;
                
                switch(dir) {
                    case 'left': checkX--; break;
                    case 'right': checkX++; break;
                    case 'up': checkY--; break;
                    case 'down': checkY++; break;
                }
                
                if (checkY < 0 || checkY >= game.maze.length) return false;
                if (checkX < 0 || checkX >= game.maze[0].length) return false;
                
                return game.maze[checkY][checkX] !== '#';
            }
            
            move(dir) {
                if (!this.canMove(dir)) return false;
                
                switch(dir) {
                    case 'left': this.gridX--; break;
                    case 'right': this.gridX++; break;
                    case 'up': this.gridY--; break;
                    case 'down': this.gridY++; break;
                }
                
                this.x = this.gridX * game.cellSize + game.cellSize / 2;
                this.y = this.gridY * game.cellSize + game.cellSize / 2;
                this.direction = dir;
                return true;
            }
        }

        class PacMan extends Entity {
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // Rotation based on direction
                switch(this.direction) {
                    case 'left': ctx.rotate(Math.PI); break;
                    case 'down': ctx.rotate(Math.PI / 2); break;
                    case 'up': ctx.rotate(-Math.PI / 2); break;
                }
                
                // Draw Pac-Man
                ctx.fillStyle = game.colors.player;
                ctx.beginPath();
                ctx.arc(0, 0, 12, 0.3, Math.PI * 2 - 0.3, false);
                ctx.lineTo(0, 0);
                ctx.fill();
                
                ctx.restore();
            }
        }

        class Ghost extends Entity {
            constructor(gridX, gridY, colorIndex) {
                super(gridX, gridY);
                this.colorIndex = colorIndex;
                this.updateCounter = 0;
                this.vulnerable = false;
            }
            
            draw() {
                ctx.save();
                
                const color = game.powerMode ? '#0000ff' : game.colors.ghost[this.colorIndex];
                ctx.fillStyle = color;
                
                // Ghost body
                ctx.fillRect(this.x - 12, this.y - 12, 24, 24);
                ctx.beginPath();
                ctx.arc(this.x - 8, this.y + 12, 4, 0, Math.PI * 2);
                ctx.arc(this.x, this.y + 12, 4, 0, Math.PI * 2);
                ctx.arc(this.x + 8, this.y + 12, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Eyes
                ctx.fillStyle = '#fff';
                ctx.fillRect(this.x - 8, this.y - 6, 3, 3);
                ctx.fillRect(this.x + 2, this.y - 6, 3, 3);
                
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x - 7, this.y - 5, 2, 2);
                ctx.fillRect(this.x + 3, this.y - 5, 2, 2);
                
                ctx.restore();
            }
            
            updateAI() {
                this.updateCounter++;
                if (this.updateCounter < 20) return;
                this.updateCounter = 0;
                
                if (game.powerMode) {
                    // Flee from Pac-Man
                    this.fleeAI();
                } else {
                    // Chase Pac-Man
                    this.chaseAI();
                }
            }
            
            chaseAI() {
                const dx = pacman.gridX - this.gridX;
                const dy = pacman.gridY - this.gridY;
                
                const directions = [];
                if (Math.abs(dx) > Math.abs(dy)) {
                    directions.push(dx > 0 ? 'right' : 'left');
                    directions.push(dy > 0 ? 'down' : 'up');
                } else {
                    directions.push(dy > 0 ? 'down' : 'up');
                    directions.push(dx > 0 ? 'right' : 'left');
                }
                
                for (let dir of directions) {
                    if (this.canMove(dir)) {
                        this.move(dir);
                        return;
                    }
                }
                
                this.randomDirection();
            }
            
            fleeAI() {
                const dx = pacman.gridX - this.gridX;
                const dy = pacman.gridY - this.gridY;
                
                const directions = [];
                if (Math.abs(dx) > Math.abs(dy)) {
                    directions.push(dx > 0 ? 'left' : 'right');
                    directions.push(dy > 0 ? 'up' : 'down');
                } else {
                    directions.push(dy > 0 ? 'up' : 'down');
                    directions.push(dx > 0 ? 'left' : 'right');
                }
                
                for (let dir of directions) {
                    if (this.canMove(dir)) {
                        this.move(dir);
                        return;
                    }
                }
                
                this.randomDirection();
            }
            
            randomDirection() {
                const dirs = ['left', 'right', 'up', 'down'];
                const valid = dirs.filter(d => this.canMove(d));
                
                if (valid.length > 0) {
                    const dir = valid[Math.floor(Math.random() * valid.length)];
                    this.move(dir);
                }
            }
        }

        // =====================================================
        // GAME OBJECTS
        // =====================================================
        let pacman;
        let ghosts = [];
        let dots = [];
        let pellets = [];

        function initGame() {
            pacman = new PacMan(1, 1);
            ghosts = [];
            dots = [];
            pellets = [];
            
            const ghostSpawns = [
                { x: 11, y: 4 },
                { x: 12, y: 4 },
                { x: 11, y: 5 },
                { x: 12, y: 5 }
            ];
            
            ghostSpawns.forEach((spawn, i) => {
                ghosts.push(new Ghost(spawn.x, spawn.y, i));
            });
            
            // Create dots and pellets
            game.maze.forEach((row, y) => {
                row.split('').forEach((cell, x) => {
                    if (cell === '.') {
                        dots.push({ x, y, active: true });
                    } else if (cell === 'P') {
                        pellets.push({ x, y, active: true, pulse: 0 });
                    }
                });
            });
        }

        // =====================================================
        // INPUT HANDLING
        // =====================================================
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toUpperCase()] = true;
            
            if (e.key === 'ArrowLeft') {
                pacman.nextDirection = 'left';
                e.preventDefault();
            }
            if (e.key === 'ArrowRight') {
                pacman.nextDirection = 'right';
                e.preventDefault();
            }
            if (e.key === 'ArrowUp') {
                pacman.nextDirection = 'up';
                e.preventDefault();
            }
            if (e.key === 'ArrowDown') {
                pacman.nextDirection = 'down';
                e.preventDefault();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toUpperCase()] = false;
        });

        // =====================================================
        // GAME LOGIC
        // =====================================================
        function update() {
            if (!game.gameRunning) return;
            
            // Update Pac-Man
            if (pacman.nextDirection && pacman.canMove(pacman.nextDirection)) {
                pacman.move(pacman.nextDirection);
                pacman.nextDirection = null;
            } else if (!pacman.direction || !pacman.canMove(pacman.direction)) {
                // Stop if can't continue
            } else {
                pacman.move(pacman.direction);
            }
            
            // Update ghosts
            ghosts.forEach(ghost => {
                ghost.updateAI();
            });
            
            // Check pellet collection
            pellets.forEach(pellet => {
                if (pellet.active && pellet.x === pacman.gridX && pellet.y === pacman.gridY) {
                    pellet.active = false;
                    game.score += 50;
                    activatePowerMode();
                    document.getElementById('score').textContent = game.score;
                }
            });
            
            // Check dot collection
            dots.forEach(dot => {
                if (dot.active && dot.x === pacman.gridX && dot.y === pacman.gridY) {
                    dot.active = false;
                    game.score += 10;
                    document.getElementById('score').textContent = game.score;
                    
                    if (dots.every(d => !d.active) && pellets.every(p => !p.active)) {
                        endGame(true);
                    }
                }
            });
            
            // Check ghost collision
            ghosts.forEach(ghost => {
                if (ghost.gridX === pacman.gridX && ghost.gridY === pacman.gridY) {
                    if (game.powerMode) {
                        // Eat ghost
                        ghost.gridX = 11;
                        ghost.gridY = 4;
                        ghost.x = ghost.gridX * game.cellSize + game.cellSize / 2;
                        ghost.y = ghost.gridY * game.cellSize + game.cellSize / 2;
                        game.score += 200;
                        document.getElementById('score').textContent = game.score;
                    } else {
                        endGame(false);
                    }
                }
            });
            
            // Check power mode expiry
            if (game.powerMode && Date.now() > game.powerEndTime) {
                game.powerMode = false;
            }
        }

        function activatePowerMode() {
            game.powerMode = true;
            game.powerEndTime = Date.now() + 7000;
        }

        // =====================================================
        // RENDERING
        // =====================================================
        function draw() {
            // Background
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw maze walls
            ctx.fillStyle = game.colors.wall;
            game.maze.forEach((row, y) => {
                row.split('').forEach((cell, x) => {
                    if (cell === '#') {
                        ctx.fillRect(x * game.cellSize, y * game.cellSize, game.cellSize, game.cellSize);
                    }
                });
            });
            
            // Draw dots
            dots.forEach(dot => {
                if (dot.active) {
                    ctx.fillStyle = game.colors.dot;
                    ctx.beginPath();
                    ctx.arc(dot.x * game.cellSize + game.cellSize / 2, dot.y * game.cellSize + game.cellSize / 2, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // Draw pellets (with pulse)
            pellets.forEach(pellet => {
                if (pellet.active) {
                    pellet.pulse += 0.1;
                    const radius = 6 + Math.sin(pellet.pulse) * 2;
                    ctx.fillStyle = game.colors.pellet;
                    ctx.beginPath();
                    ctx.arc(pellet.x * game.cellSize + game.cellSize / 2, pellet.y * game.cellSize + game.cellSize / 2, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // Draw Pac-Man
            pacman.draw();
            
            // Draw ghosts
            ghosts.forEach(ghost => {
                ghost.draw();
            });
        }

        function endGame(win) {
            game.gameRunning = false;
            
            const gameOverDiv = document.getElementById('gameOver');
            const msg = win ? 'ðŸŽ‰ You Win! ðŸŽ‰' : 'ðŸ’€ Game Over ðŸ’€';
            const color = win ? '#ffff00' : '#ff0000';
            
            gameOverDiv.innerHTML = `
                <div style="font-size: 36px; color: ${color};">${msg}</div>
                <div style="font-size: 20px; color: #fff;">Final Score: ${game.score}</div>
                <div style="font-size: 14px; color: #ccc; margin-top: 20px;">Click to Restart</div>
            `;
            gameOverDiv.style.display = 'block';
            
            gameOverDiv.addEventListener('click', () => {
                game.gameRunning = true;
                game.score = 0;
                document.getElementById('score').textContent = '0';
                gameOverDiv.style.display = 'none';
                initGame();
            });
        }

        // =====================================================
        // GAME LOOP
        // =====================================================
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // =====================================================
        // INIT
        // =====================================================
        initGame();
        console.log('ðŸŽ® Pac-Man Game Started!');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
